module.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=9)}([function(t,e,n){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=n(13),i=o(n(18));e.default=function(t="default"){const e=i.default[t]||i.default.default,{driver:n,host:o,port:u,database:s,user:a,password:c}=e;return(new(0,r(`./${n}.ts`).default)).init(o,u,s,a,c)}},function(t,e){t.exports=require("path")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=n(1),r=n(5).getContextModulesRoutesNames(),i={signIn:"/signin",auth:"/auth",model:`/:model(${r.join("|")})`,modelItem:o.resolve(`/:model(${r.join("|")})`,":id")};e.default=i},function(t,e){t.exports=require("bcrypt")},function(t,e,n){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.routePath=e.withMiddleware=void 0;const r=o(n(2));e.withMiddleware=(t,...e)=>()=>{const n=t();return Object.defineProperty(n,"middleware",{enumerable:!1,value:e}),n},e.routePath=t=>r.default[t]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getContextModulesRoutesNames=e.getContextModuleByRouteName=void 0;const o=n(31).buildContext(n(32));e.getContextModuleByRouteName=function(t){const e=Object.entries(o).find(([,e])=>e.routeName===t),[,n]=e;return n},e.getContextModulesRoutesNames=function(){return Object.entries(o).map(([,{routeName:t}])=>t).filter(t=>void 0!==t)}},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function u(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(n(0));e.default=class{constructor(){return this.table="",new Proxy(this,{get:(t,e)=>{if(!this.table)throw new Error(`Table of ${this.constructor.name} is undefined! Define it in your model class!`);return t[e]}})}list(t={}){return o(this,void 0,void 0,(function*(){const t=yield i.default();return(yield t.query(`\n      select * from ${this.table}\n    `)).rows}))}getById(t){return o(this,void 0,void 0,(function*(){const e=yield i.default();return(yield e.query(`\n      select * from ${this.table} where id=$1 limit 1\n    `,[t])).rows[0]}))}}},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function u(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(3),u=r(n(6)),s=r(n(0));class a extends u.default{constructor(){super(...arguments),this.table="users"}authenticate(t,e){return o(this,void 0,void 0,(function*(){const n=yield s.default(),o=(yield n.query(`\n      select * from ${this.table} where email=$1 limit 1\n    `,[t])).rows[0];if(!o)throw new Error("Unauthenticated");const{id:r,password:u}=o;if(!(yield i.compare(e,u)))throw new Error("Unauthenticated");return r}))}}const c=a;e.default=c},function(t,e,n){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(n(2));e.default=(t,e,n)=>{const{signIn:o}=r.default,{session:i,xhr:u,url:s}=t,{userId:a}=i;a?n():u?e.status(302).send({redirect:o}):s!==o?e.redirect(o):n()}},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function u(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.runCommand=e.routes=e.bootstrap=void 0;const i=r(n(10));e.runCommand=i.default;const u=r(n(22)),s=r(n(27)),a=r(n(37)),c=r(n(2));e.routes=c.default,e.bootstrap=function(t){return o(this,void 0,void 0,(function*(){yield u.default(),a.default(t),new s.default(t)}))}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=n(11);e.default=function(t,e){return(0,o(`./${t}.ts`).default)(e)}},function(t,e,n){var o={"./create.admin.ts":12,"./notes.seed.ts":20};function r(t){var e=i(t);return n(e)}function i(t){if(!n.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}r.keys=function(){return Object.keys(o)},r.resolve=i,t.exports=r,r.id=11},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function u(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(n(0)),u=n(3);e.default=function(){return o(this,void 0,void 0,(function*(){const t=yield i.default(),e=yield u.hash("123456",5);return yield t.query("\n      insert into users (name, email, password)\n      values ($1, $2, $3)\n  ",["Admin","admin@jsway.ru",e]),0}))}},function(t,e,n){var o={"./pgsql.ts":14};function r(t){var e=i(t);return n(e)}function i(t){if(!n.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}r.keys=function(){return Object.keys(o)},r.resolve=i,t.exports=r,r.id=13},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function u(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(15),u=r(n(16)),s=r(n(17));class a{get connection(){return a._client}init(t,e,n,r,c){return o(this,void 0,void 0,(function*(){if(!a._client){(yield s.default(`${t}:${e}`))||(yield u.default({host:t,port:e,timeout:15e3}));const o=new i.Client({host:t,port:e,database:n,user:r,password:c});yield o.connect(),a._client=o}return this}))}query(t,e){return o(this,void 0,void 0,(function*(){return this.connection.query(t,e)}))}}e.default=a},function(t,e){t.exports=require("pg")},function(t,e){t.exports=require("wait-port")},function(t,e){t.exports=require("is-reachable")},function(t,e,n){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(n(19)),{DB_CONNECTION:i="pgsql",DB_HOST:u="localhost",DB_PORT:s=5432,DB_NAME:a="postgres",DB_USER:c="postgres",DB_PASSWORD:l=""}=r.default(process.env),d={default:{driver:i,host:u,port:s,database:a,user:c,password:l}};e.default=d},function(t,e){t.exports=require("dotenv-parse-variables")},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function u(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(n(0)),u=n(21);e.default=function(){return o(this,void 0,void 0,(function*(){const t=yield i.default();for(let e in Array.from(Array(3)))yield t.query("\n      insert into notes (title, description) values ($1, $2)\n    ",[u.lorem.word(),u.lorem.paragraphs()]);return 0}))}},function(t,e){t.exports=require("faker")},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function u(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const r=n(1),i=n(23),u=n(24);e.default=function(){return o(this,void 0,void 0,(function*(){const t=r.resolve("/home/dunloop/www/@jsway/planner/storage","migrations.json"),e=i.existsSync(t)?JSON.parse(i.readFileSync(t).toString()):{},n=yield u.keys().sort((t,e)=>{const[{birthtimeMs:n},{birthtimeMs:o}]=[t,e].map(t=>i.statSync(r.resolve("/home/dunloop/www/@jsway/planner/src/backend/migrations",t)));return n-o}).reduce((t,n)=>t.then(t=>o(this,void 0,void 0,(function*(){const o=r.parse(n).name;if(e[o])return t;const i=new(0,u(n).default);return yield i.up(),t[o]={key:o,time:(new Date).toLocaleString("ru")},t}))),Promise.resolve({}));i.writeFileSync(t,JSON.stringify(Object.assign(Object.assign({},e),n),null,2))}))}},function(t,e){t.exports=require("fs")},function(t,e,n){var o={"./create.notes.table.ts":25,"./create.users.table.ts":26};function r(t){var e=i(t);return n(e)}function i(t){if(!n.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}r.keys=function(){return Object.keys(o)},r.resolve=i,t.exports=r,r.id=24},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function u(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.down=e.up=void 0;const i=r(n(0));e.up=function(){return o(this,void 0,void 0,(function*(){return(yield i.default()).query("\n    create table notes (\n      id bigserial not null constraint notes_pkey primary key,\n      title varchar(255) not null,\n      description text\n    );\n  ")}))},e.down=function(){return o(this,void 0,void 0,(function*(){}))}},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function u(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(n(0));e.default=class{up(){return o(this,void 0,void 0,(function*(){return(yield i.default()).query("\n      create table users (\n        id bigserial not null constraint users_pkey primary key,\n        name varchar(255) not null,\n        email varchar(255) not null constraint users_email_unique unique,\n        password varchar(255) not null,\n        auth_token varchar(100),\n        active boolean default true not null\n      );\n    ")}))}down(){}}},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function u(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const r=n(1),i=n(28);e.default=class{constructor(t){this.app=t;for(let t of i.keys())this.handleController(t)}handleController(t){const e=i(t).default,n=r.parse(t).name,o=Array.isArray(e)?e:[e];for(let t of o){const e="index"!==n?n:void 0;this.handleRoutes(t,e)}}handleRoutes(t,e){const n=t();for(let t of n)this.handleRoute(t,{prefix:e,middleware:n.middleware})}handleRoute(t,e){const{prefix:n,middleware:i}=e,{method:u,path:s,response:a}=t,c=u,l="string"==typeof s?r.join("/"+(n||""),s):s;this.app[c](l,...i||[],(t,e,n)=>o(this,void 0,void 0,(function*(){if("function"==typeof a){const{error:n,message:o}=yield a(t).then(t=>({error:!1,message:t})).catch(t=>({error:!0,message:Object.getOwnPropertyNames(t).reduce((e,n)=>{const o=t[n];return e[n]=o.match(/\n/)?o.split(/\n/):o,e},{})}));e.status(n?404:200).send(o)}else n()})))}}},function(t,e,n){var o={"./api.ts":29,"./index.ts":36};function r(t){var e=i(t);return n(e)}function i(t){if(!n.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}r.keys=function(){return Object.keys(o)},r.resolve=i,t.exports=r,r.id=28},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function u(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(30),u=n(4),s=n(5),a=r(n(7)),c=r(n(8)),l=n(34);e.default=[u.withMiddleware(()=>[{method:"post",path:u.routePath("auth"),response:({session:t,body:e})=>o(void 0,void 0,void 0,(function*(){const{login:n,password:o}=e,r=yield(new a.default).authenticate(n,o);return r&&(t.userId=r,t.accessToken=i.randomBytes(24).toString("hex")),r}))}],l.json),u.withMiddleware(()=>[{method:"get",path:u.routePath("model"),response:({params:t})=>o(void 0,void 0,void 0,(function*(){const{model:e}=t;return(new(s.getContextModuleByRouteName(e))).list()}))},{method:"get",path:u.routePath("modelItem"),response:({params:t})=>o(void 0,void 0,void 0,(function*(){const{model:e,id:n}=t;return(new(s.getContextModuleByRouteName(e))).getById(n)}))}],l.json,c.default)]},function(t,e){t.exports=require("crypto")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.buildContext=void 0;const o=n(1);e.buildContext=function(t){return t.keys().reduce((e,n)=>{const r=t(n).default;return e[o.parse(n).name]=r,e},{})}},function(t,e,n){var o={"./note.ts":33,"./user.ts":7};function r(t){var e=i(t);return n(e)}function i(t){if(!n.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}r.keys=function(){return Object.keys(o)},r.resolve=i,t.exports=r,r.id=32},function(t,e,n){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(n(6));class i extends r.default{constructor(){super(...arguments),this.table="notes"}}i.routeName="notes";const u=i;e.default=u},function(t,e,n){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.json=void 0;const r=o(n(35)).default.json();e.json=r},function(t,e){t.exports=require("express")},function(t,e,n){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=n(4),i=o(n(8));e.default=r.withMiddleware(()=>[{method:"get",path:r.routePath("signIn")},{method:"get",path:r.routePath("model")},{method:"get",path:r.routePath("modelItem")}],i.default)},function(t,e,n){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(n(38));e.default=function(t){t.use(r.default({secret:"session-secret"}))}},function(t,e){t.exports=require("express-session")}]);