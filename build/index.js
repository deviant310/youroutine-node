module.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(11),i=r(n(16));e.default=function(t="default"){const e=i.default[t]||i.default.default,{driver:n,host:r,port:u,database:s,user:a,password:c}=e;return(new(0,o(`./${n}.ts`).default)).init(r,u,s,a,c)}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function s(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((r=r.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=o(n(4)),u=o(n(0)),s=n(2);class a extends i.default{constructor(){super(...arguments),this.table="users"}authorize(){return r(this,void 0,void 0,(function*(){return{name:"Vasya"}}))}authenticate(t,e){return r(this,void 0,void 0,(function*(){const n=yield u.default(),r=(yield n.query(`\n      select * from ${this.table} where email=$1 limit 1\n    `,[t])).rows[0];if(!r)throw new Error("Unauthenticated");const{password:o}=r;if(!(yield s.compare(e,o)))throw new Error("Unauthenticated");return r}))}}e.default=a},function(t,e){t.exports=require("bcrypt")},function(t,e){t.exports=require("path")},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function s(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((r=r.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=o(n(0));e.default=class{constructor(){return this.table="",new Proxy(this,{get:(t,e)=>{if(!this.table)throw new Error(`Table of ${this.constructor.name} is undefined! Define it in your model class!`);return t[e]}})}list(t={}){return r(this,void 0,void 0,(function*(){const t=yield i.default();return(yield t.query(`\n      select * from ${this.table}\n    `)).rows}))}getById(t){return r(this,void 0,void 0,(function*(){const e=yield i.default();return(yield e.query(`\n      select * from ${this.table} where id=$1 limit 1\n    `,[t])).rows[0]}))}}},function(t,e,n){var r={"./note":6,"./note.ts":6,"./user":1,"./user.ts":1};function o(t){var e=i(t);return n(e)}function i(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}o.keys=function(){return Object.keys(r)},o.resolve=i,t.exports=o,o.id=5},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(n(4));class i extends o.default{constructor(){super(...arguments),this.table="notes"}}e.default=i},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function s(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((r=r.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Console=e.bootstrap=void 0;const i=o(n(8));e.Console=i.default;const u=o(n(20)),s=o(n(25));e.bootstrap=function(t){return r(this,void 0,void 0,(function*(){yield u.default(),s.default(t)}))}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(9);e.default=class{static runCommand(t,e){return(0,r(`./${t}.ts`).default)(e)}}},function(t,e,n){var r={"./create.admin.ts":10,"./notes.seed.ts":18};function o(t){var e=i(t);return n(e)}function i(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}o.keys=function(){return Object.keys(r)},o.resolve=i,t.exports=o,o.id=9},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function s(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((r=r.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=o(n(0)),u=n(2);e.default=function(){return r(this,void 0,void 0,(function*(){const t=yield i.default(),e=yield u.hash("123456",5);return yield t.query("\n      insert into users (name, email, password)\n      values ($1, $2, $3)\n  ",["Admin","admin@jsway.ru",e]),0}))}},function(t,e,n){var r={"./pgsql.ts":12};function o(t){var e=i(t);return n(e)}function i(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}o.keys=function(){return Object.keys(r)},o.resolve=i,t.exports=o,o.id=11},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function s(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((r=r.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(13),u=o(n(14)),s=o(n(15));class a{get connection(){return a._client}init(t,e,n,o,c){return r(this,void 0,void 0,(function*(){if(!a._client){(yield s.default(`${t}:${e}`))||(yield u.default({host:t,port:e,timeout:15e3}));const r=new i.Client({host:t,port:e,database:n,user:o,password:c});yield r.connect(),a._client=r}return this}))}query(t,e){return r(this,void 0,void 0,(function*(){return this.connection.query(t,e)}))}}e.default=a},function(t,e){t.exports=require("pg")},function(t,e){t.exports=require("wait-port")},function(t,e){t.exports=require("is-reachable")},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(n(17)),{DB_CONNECTION:i="pgsql",DB_HOST:u="localhost",DB_PORT:s=5432,DB_NAME:a="postgres",DB_USER:c="postgres",DB_PASSWORD:f=""}=o.default(process.env),l={default:{driver:i,host:u,port:s,database:a,user:c,password:f}};e.default=l},function(t,e){t.exports=require("dotenv-parse-variables")},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function s(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((r=r.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=o(n(0)),u=n(19);e.default=function(){return r(this,void 0,void 0,(function*(){const t=yield i.default();for(let e in Array.from(Array(3)))yield t.query("\n      insert into notes (title, description) values ($1, $2)\n    ",[u.lorem.word(),u.lorem.paragraphs()]);return 0}))}},function(t,e){t.exports=require("faker")},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function s(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const o=n(3),i=n(21),u=n(22);e.default=function(){return r(this,void 0,void 0,(function*(){const t=o.resolve("/home/dunloop/www/@jsway/planner/storage","migrations.json"),e=i.existsSync(t)?JSON.parse(i.readFileSync(t).toString()):{},n=yield u.keys().sort((t,e)=>{const[{birthtimeMs:n},{birthtimeMs:r}]=[t,e].map(t=>i.statSync(o.resolve("/home/dunloop/www/@jsway/planner/src/backend/migrations",t)));return n-r}).reduce((t,n)=>t.then(t=>r(this,void 0,void 0,(function*(){const r=o.parse(n).name;if(e[r])return t;const i=new(0,u(n).default);return yield i.up(),t[r]={key:r,time:(new Date).toLocaleString("ru")},t}))),Promise.resolve({}));i.writeFileSync(t,JSON.stringify(Object.assign(Object.assign({},e),n),null,2))}))}},function(t,e){t.exports=require("fs")},function(t,e,n){var r={"./create.notes.table.ts":23,"./create.users.table.ts":24};function o(t){var e=i(t);return n(e)}function i(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}o.keys=function(){return Object.keys(r)},o.resolve=i,t.exports=o,o.id=22},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function s(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((r=r.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.down=e.up=void 0;const i=o(n(0));e.up=function(){return r(this,void 0,void 0,(function*(){return(yield i.default()).query("\n    create table notes (\n      id bigserial not null constraint notes_pkey primary key,\n      title varchar(255) not null,\n      description text\n    );\n  ")}))},e.down=function(){return r(this,void 0,void 0,(function*(){}))}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function s(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((r=r.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=o(n(0));e.default=class{up(){return r(this,void 0,void 0,(function*(){return(yield i.default()).query("\n      create table users (\n        id bigserial not null constraint users_pkey primary key,\n        name varchar(255) not null,\n        email varchar(255) not null constraint users_email_unique unique,\n        password varchar(255) not null,\n        auth_token varchar(100),\n        active boolean default true not null\n      );\n    ")}))}down(){}}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function s(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const o=n(3),i=n(26);e.default=function(t){for(let e of i.keys()){const n=i(e).default,u=o.parse(e).name;for(let e of n){const{method:n,path:i,bodyParser:s,response:a}=e;t[n](o.join("/"+u,i),s,(t,e)=>r(this,void 0,void 0,(function*(){const{error:n,message:r}=yield a(t).then(t=>({error:!1,message:t})).catch(({message:t})=>({error:!0,message:t}));e.status(n?404:200).send(r)})))}}}},function(t,e,n){var r={"./api.ts":27};function o(t){var e=i(t);return n(e)}function i(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}o.keys=function(){return Object.keys(r)},o.resolve=i,t.exports=o,o.id=26},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function s(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((r=r.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=o(n(28)),u=o(n(1)),s=[{method:"post",path:"/login",bodyParser:i.default.json(),response:({body:t})=>r(void 0,void 0,void 0,(function*(){const{login:e,password:n}=t;return(new u.default).authenticate(e,n)}))},{method:"get",path:"/auth",bodyParser:i.default.json(),response:()=>r(void 0,void 0,void 0,(function*(){return(new u.default).authorize()}))},{method:"get",path:"/:model",bodyParser:i.default.json(),response:({params:t})=>r(void 0,void 0,void 0,(function*(){const{model:e}=t;return(new(0,n(5)("./"+e).default)).list()}))},{method:"get",path:"/:model/:id",bodyParser:i.default.json(),response:({params:t})=>r(void 0,void 0,void 0,(function*(){const{model:e,id:r}=t;return(new(0,n(5)("./"+e).default)).getById(r)}))}];e.default=s},function(t,e){t.exports=require("express")}]);